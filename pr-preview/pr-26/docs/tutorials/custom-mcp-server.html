<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A community-driven collection of Docker Model Context Protocol (MCP) servers, tools, and resources.">
  <meta name="keywords" content="docker, mcp, model, context, protocol, servers, tools, community">
  <title>MCP Community Portal</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/pr-preview/pr-26/assets/images/docker-logo.svg">
  
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/pr-preview/pr-26/assets/css/main.css">
  <link rel="stylesheet" href="/pr-preview/pr-26/assets/css/tools.css">
  <link rel="stylesheet" href="/pr-preview/pr-26/assets/css/home.css">
  <link rel="stylesheet" href="/pr-preview/pr-26/assets/css/lab-styles.css">
  <link rel="stylesheet" href="/pr-preview/pr-26/assets/css/code-fix.css">
  <link rel="stylesheet" href="/pr-preview/pr-26/assets/css/banner-fix.css">
  <link rel="stylesheet" href="/pr-preview/pr-26/assets/css/image-fix.css">
  <link rel="stylesheet" href="/pr-preview/pr-26/assets/css/heading-fix.css">
  <link rel="stylesheet" href="/pr-preview/pr-26/assets/css/header-fix.css">
  
  <!-- Syntax Highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
  
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>MCP Community Portal | A community-driven collection of Dockerized Model Context Protocol servers</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="MCP Community Portal" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A community-driven collection of Dockerized Model Context Protocol servers" />
<meta property="og:description" content="A community-driven collection of Dockerized Model Context Protocol servers" />
<link rel="canonical" href="https://mcp.collabnix.com/pr-preview/pr-26/docs/tutorials/custom-mcp-server.html" />
<meta property="og:url" content="https://mcp.collabnix.com/pr-preview/pr-26/docs/tutorials/custom-mcp-server.html" />
<meta property="og:site_name" content="MCP Community Portal" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="MCP Community Portal" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"A community-driven collection of Dockerized Model Context Protocol servers","headline":"MCP Community Portal","url":"https://mcp.collabnix.com/pr-preview/pr-26/docs/tutorials/custom-mcp-server.html"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>
  <header class="site-header">
  <div class="container">
    <div class="header-content">
      <div class="logo">
        <a href="/pr-preview/pr-26/">
          <h1>MCP Community Portal</h1>
        </a>
      </div>
      <nav class="main-nav">
        <ul>
          <li><a href="/pr-preview/pr-26/"><i class="fas fa-home"></i> Home</a></li>
          <li><a href="/pr-preview/pr-26/servers-table.html"><i class="fas fa-server"></i> Servers</a></li>
          <li><a href="/pr-preview/pr-26/tools.html"><i class="fas fa-tools"></i> Tools</a></li>
          <li><a href="/pr-preview/pr-26/docs/labs-and-tutorials"><i class="fas fa-flask"></i> Labs</a></li>
          <li>
            <a href="/pr-preview/pr-26/docs/ask-gordon">
              <i class="fas fa-robot"></i> Ask Gordon
              <span class="new-badge">NEW</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</header>

<style>
.new-badge {
  display: inline-block;
  background-color: #FF5722;
  color: white;
  font-size: 0.7rem;
  font-weight: bold;
  padding: 0.15rem 0.4rem;
  border-radius: 3px;
  margin-left: 6px;
  vertical-align: middle;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
  }
  100% {
    opacity: 1;
  }
}
</style>
  
  <main>
    <h1 id="tutorial-building-custom-mcp-servers">Tutorial: Building Custom MCP Servers</h1>

<p>In this advanced tutorial, you’ll learn how to create your own custom Model Context Protocol (MCP) server and package it as a Docker container. This will allow you to extend AI assistants like Gordon with capabilities tailored to your specific needs.</p>

<p><strong>Time to complete:</strong> 90-120 minutes</p>

<p><strong>Prerequisites:</strong></p>
<ul>
  <li>Solid understanding of Docker and containerization</li>
  <li>Experience with Python programming</li>
  <li>Familiarity with API development</li>
  <li>Completion of previous MCP labs (recommended)</li>
</ul>

<h2 id="learning-objectives">Learning Objectives</h2>

<p>By the end of this tutorial, you’ll be able to:</p>
<ol>
  <li>Understand the MCP server architecture and protocol</li>
  <li>Implement a custom MCP server in Python</li>
  <li>Package your MCP server as a Docker container</li>
  <li>Test and debug your MCP server with Gordon AI</li>
  <li>Deploy your MCP server for production use</li>
</ol>

<h2 id="understanding-mcp-architecture">Understanding MCP Architecture</h2>

<p>Before building a custom server, it’s important to understand how MCP works:</p>

<ol>
  <li><strong>MCP Protocol</strong>: A standardized way for AI assistants to interact with external systems</li>
  <li><strong>MCP Servers</strong>: Services that implement the protocol to provide specific capabilities</li>
  <li><strong>Discovery</strong>: AI assistants discover available MCP servers through configuration</li>
  <li><strong>Interaction Flow</strong>:
    <ul>
      <li>AI identifies a need for external context</li>
      <li>AI sends a request to the appropriate MCP server</li>
      <li>MCP server processes the request and returns contextual information</li>
      <li>AI incorporates this context into its response</li>
    </ul>
  </li>
</ol>

<h2 id="step-1-setting-up-your-development-environment">Step 1: Setting Up Your Development Environment</h2>

<p>Create a directory for your custom MCP server project:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>custom-mcp-server
<span class="nb">cd </span>custom-mcp-server
</code></pre></div></div>

<p>Create a virtual environment for Python development:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python <span class="nt">-m</span> venv venv
<span class="nb">source </span>venv/bin/activate  <span class="c"># On Windows: venv\Scripts\activate</span>
</code></pre></div></div>

<p>Install the required packages:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>fastapi uvicorn pydantic mcp
</code></pre></div></div>

<h2 id="step-2-creating-a-simple-weather-mcp-server">Step 2: Creating a Simple Weather MCP Server</h2>

<p>Let’s create a simple MCP server that provides weather information. We’ll use a free weather API for this example.</p>

<p>First, create a basic project structure:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> weather_mcp/app
<span class="nb">touch </span>weather_mcp/app/__init__.py
<span class="nb">touch </span>weather_mcp/app/main.py
<span class="nb">touch </span>weather_mcp/Dockerfile
<span class="nb">touch </span>weather_mcp/requirements.txt
</code></pre></div></div>

<p>Add the following to <code class="language-plaintext highlighter-rouge">weather_mcp/requirements.txt</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fastapi&gt;=0.103.1
uvicorn&gt;=0.23.2
pydantic&gt;=2.4.2
httpx&gt;=0.25.0
python-dotenv&gt;=1.0.0
</code></pre></div></div>

<p>Now, let’s implement our main application in <code class="language-plaintext highlighter-rouge">weather_mcp/app/main.py</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span><span class="p">,</span> <span class="n">HTTPException</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<span class="kn">import</span> <span class="nn">httpx</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">"Weather MCP Server"</span><span class="p">)</span>

<span class="c1"># Typically you'd use environment variables for API keys
</span><span class="n">WEATHER_API_KEY</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">"WEATHER_API_KEY"</span><span class="p">,</span> <span class="s">"your_demo_api_key"</span><span class="p">)</span>
<span class="n">WEATHER_API_URL</span> <span class="o">=</span> <span class="s">"https://api.weatherapi.com/v1"</span>

<span class="c1"># MCP Models
</span><span class="k">class</span> <span class="nc">MCPSpecification</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">MCPFunction</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MCPFunctionResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">content</span><span class="p">:</span> <span class="n">Any</span>

<span class="c1"># Weather Models
</span><span class="k">class</span> <span class="nc">WeatherRequest</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">location</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">units</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s">"metric"</span>  <span class="c1"># metric or imperial
</span>
<span class="k">class</span> <span class="nc">ForecastRequest</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">location</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">units</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s">"metric"</span>

<span class="c1"># MCP Discovery endpoint
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/.well-known/mcp"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">get_mcp_specification</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">MCPSpecification</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">MCPSpecification</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s">"weather"</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s">"MCP server providing weather information for locations worldwide"</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="p">{</span>
            <span class="s">"functions"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s">"name"</span><span class="p">:</span> <span class="s">"get_current_weather"</span><span class="p">,</span>
                    <span class="s">"description"</span><span class="p">:</span> <span class="s">"Get current weather conditions for a location"</span><span class="p">,</span>
                    <span class="s">"parameters"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s">"type"</span><span class="p">:</span> <span class="s">"object"</span><span class="p">,</span>
                        <span class="s">"properties"</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s">"location"</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s">"type"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span>
                                <span class="s">"description"</span><span class="p">:</span> <span class="s">"City name, ZIP code, or latitude/longitude"</span>
                            <span class="p">},</span>
                            <span class="s">"units"</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s">"type"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span>
                                <span class="s">"enum"</span><span class="p">:</span> <span class="p">[</span><span class="s">"metric"</span><span class="p">,</span> <span class="s">"imperial"</span><span class="p">],</span>
                                <span class="s">"description"</span><span class="p">:</span> <span class="s">"Units system to use for temperature and measurements"</span>
                            <span class="p">}</span>
                        <span class="p">},</span>
                        <span class="s">"required"</span><span class="p">:</span> <span class="p">[</span><span class="s">"location"</span><span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s">"name"</span><span class="p">:</span> <span class="s">"get_weather_forecast"</span><span class="p">,</span>
                    <span class="s">"description"</span><span class="p">:</span> <span class="s">"Get weather forecast for a location"</span><span class="p">,</span>
                    <span class="s">"parameters"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s">"type"</span><span class="p">:</span> <span class="s">"object"</span><span class="p">,</span>
                        <span class="s">"properties"</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s">"location"</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s">"type"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span>
                                <span class="s">"description"</span><span class="p">:</span> <span class="s">"City name, ZIP code, or latitude/longitude"</span>
                            <span class="p">},</span>
                            <span class="s">"days"</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s">"type"</span><span class="p">:</span> <span class="s">"integer"</span><span class="p">,</span>
                                <span class="s">"minimum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="s">"maximum"</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                                <span class="s">"description"</span><span class="p">:</span> <span class="s">"Number of days to forecast (1-10)"</span>
                            <span class="p">},</span>
                            <span class="s">"units"</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s">"type"</span><span class="p">:</span> <span class="s">"string"</span><span class="p">,</span>
                                <span class="s">"enum"</span><span class="p">:</span> <span class="p">[</span><span class="s">"metric"</span><span class="p">,</span> <span class="s">"imperial"</span><span class="p">],</span>
                                <span class="s">"description"</span><span class="p">:</span> <span class="s">"Units system to use for temperature and measurements"</span>
                            <span class="p">}</span>
                        <span class="p">},</span>
                        <span class="s">"required"</span><span class="p">:</span> <span class="p">[</span><span class="s">"location"</span><span class="p">,</span> <span class="s">"days"</span><span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">)</span>

<span class="c1"># Weather API endpoints
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/mcp/get_current_weather"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">current_weather</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">WeatherRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MCPFunctionResponse</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="p">.</span><span class="n">AsyncClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">get</span><span class="p">(</span>
                <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">WEATHER_API_URL</span><span class="si">}</span><span class="s">/current.json"</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                    <span class="s">"key"</span><span class="p">:</span> <span class="n">WEATHER_API_KEY</span><span class="p">,</span>
                    <span class="s">"q"</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">location</span><span class="p">,</span>
                    <span class="s">"aqi"</span><span class="p">:</span> <span class="s">"no"</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
            
            <span class="c1"># Process based on units requested
</span>            <span class="n">temp_key</span> <span class="o">=</span> <span class="s">"temp_c"</span> <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">units</span> <span class="o">==</span> <span class="s">"metric"</span> <span class="k">else</span> <span class="s">"temp_f"</span>
            <span class="n">wind_key</span> <span class="o">=</span> <span class="s">"wind_kph"</span> <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">units</span> <span class="o">==</span> <span class="s">"metric"</span> <span class="k">else</span> <span class="s">"wind_mph"</span>
            <span class="n">precip_key</span> <span class="o">=</span> <span class="s">"precip_mm"</span> <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">units</span> <span class="o">==</span> <span class="s">"metric"</span> <span class="k">else</span> <span class="s">"precip_in"</span>
            
            <span class="n">weather_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">"location"</span><span class="p">:</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s">'location'</span><span class="p">][</span><span class="s">'name'</span><span class="p">]</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s">'location'</span><span class="p">][</span><span class="s">'country'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">,</span>
                <span class="s">"temperature"</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">'current'</span><span class="p">][</span><span class="n">temp_key</span><span class="p">],</span>
                <span class="s">"condition"</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">'current'</span><span class="p">][</span><span class="s">'condition'</span><span class="p">][</span><span class="s">'text'</span><span class="p">],</span>
                <span class="s">"humidity"</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">'current'</span><span class="p">][</span><span class="s">'humidity'</span><span class="p">],</span>
                <span class="s">"wind_speed"</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">'current'</span><span class="p">][</span><span class="n">wind_key</span><span class="p">],</span>
                <span class="s">"precipitation"</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">'current'</span><span class="p">][</span><span class="n">precip_key</span><span class="p">],</span>
                <span class="s">"is_day"</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">'current'</span><span class="p">][</span><span class="s">'is_day'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s">"last_updated"</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="s">'current'</span><span class="p">][</span><span class="s">'last_updated'</span><span class="p">],</span>
                <span class="s">"units"</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">units</span>
            <span class="p">}</span>
            
            <span class="k">return</span> <span class="n">MCPFunctionResponse</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">weather_data</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">httpx</span><span class="p">.</span><span class="n">HTTPStatusError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">e</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s">"Weather API error"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/mcp/get_weather_forecast"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">weather_forecast</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">ForecastRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MCPFunctionResponse</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="p">.</span><span class="n">AsyncClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="p">.</span><span class="n">get</span><span class="p">(</span>
                <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">WEATHER_API_URL</span><span class="si">}</span><span class="s">/forecast.json"</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="p">{</span>
                    <span class="s">"key"</span><span class="p">:</span> <span class="n">WEATHER_API_KEY</span><span class="p">,</span>
                    <span class="s">"q"</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">location</span><span class="p">,</span>
                    <span class="s">"days"</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">days</span><span class="p">,</span>
                    <span class="s">"aqi"</span><span class="p">:</span> <span class="s">"no"</span><span class="p">,</span>
                    <span class="s">"alerts"</span><span class="p">:</span> <span class="s">"no"</span>
                <span class="p">}</span>
            <span class="p">)</span>
            <span class="n">response</span><span class="p">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">json</span><span class="p">()</span>
            
            <span class="c1"># Extract forecast data based on units
</span>            <span class="n">temp_key</span> <span class="o">=</span> <span class="s">"avgtemp_c"</span> <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">units</span> <span class="o">==</span> <span class="s">"metric"</span> <span class="k">else</span> <span class="s">"avgtemp_f"</span>
            <span class="n">precip_key</span> <span class="o">=</span> <span class="s">"totalprecip_mm"</span> <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">units</span> <span class="o">==</span> <span class="s">"metric"</span> <span class="k">else</span> <span class="s">"totalprecip_in"</span>
            
            <span class="n">forecast_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">"location"</span><span class="p">:</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s">'location'</span><span class="p">][</span><span class="s">'name'</span><span class="p">]</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s">'location'</span><span class="p">][</span><span class="s">'country'</span><span class="p">]</span><span class="si">}</span><span class="s">"</span><span class="p">,</span>
                <span class="s">"forecast"</span><span class="p">:</span> <span class="p">[]</span>
            <span class="p">}</span>
            
            <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">'forecast'</span><span class="p">][</span><span class="s">'forecastday'</span><span class="p">][:</span><span class="n">request</span><span class="p">.</span><span class="n">days</span><span class="p">]:</span>
                <span class="n">forecast_data</span><span class="p">[</span><span class="s">'forecast'</span><span class="p">].</span><span class="n">append</span><span class="p">({</span>
                    <span class="s">"date"</span><span class="p">:</span> <span class="n">day</span><span class="p">[</span><span class="s">'date'</span><span class="p">],</span>
                    <span class="s">"avg_temp"</span><span class="p">:</span> <span class="n">day</span><span class="p">[</span><span class="s">'day'</span><span class="p">][</span><span class="n">temp_key</span><span class="p">],</span>
                    <span class="s">"condition"</span><span class="p">:</span> <span class="n">day</span><span class="p">[</span><span class="s">'day'</span><span class="p">][</span><span class="s">'condition'</span><span class="p">][</span><span class="s">'text'</span><span class="p">],</span>
                    <span class="s">"chance_of_rain"</span><span class="p">:</span> <span class="n">day</span><span class="p">[</span><span class="s">'day'</span><span class="p">][</span><span class="s">'daily_chance_of_rain'</span><span class="p">],</span>
                    <span class="s">"precipitation"</span><span class="p">:</span> <span class="n">day</span><span class="p">[</span><span class="s">'day'</span><span class="p">][</span><span class="n">precip_key</span><span class="p">],</span>
                    <span class="s">"humidity"</span><span class="p">:</span> <span class="n">day</span><span class="p">[</span><span class="s">'day'</span><span class="p">][</span><span class="s">'avghumidity'</span><span class="p">]</span>
                <span class="p">})</span>
            
            <span class="k">return</span> <span class="n">MCPFunctionResponse</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">forecast_data</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">httpx</span><span class="p">.</span><span class="n">HTTPStatusError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">e</span><span class="p">.</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="s">"Weather API error"</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s">"Error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">uvicorn</span>
    <span class="n">uvicorn</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="s">"main:app"</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">"0.0.0.0"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span> <span class="nb">reload</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="step-3-dockerizing-your-mcp-server">Step 3: Dockerizing Your MCP Server</h2>

<p>Create a Dockerfile in the <code class="language-plaintext highlighter-rouge">weather_mcp</code> directory:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> python:3.11-slim</span>

<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="k">COPY</span><span class="s"> requirements.txt .</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nt">-r</span> requirements.txt

<span class="k">COPY</span><span class="s"> app/ ./app/</span>

<span class="k">EXPOSE</span><span class="s"> 8080</span>

<span class="k">CMD</span><span class="s"> ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8080"]</span>
</code></pre></div></div>

<p>Now build your Docker image:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>weather_mcp
docker build <span class="nt">-t</span> mcp/weather <span class="nb">.</span>
</code></pre></div></div>

<h2 id="step-4-testing-your-mcp-server">Step 4: Testing Your MCP Server</h2>

<p>Let’s create a test configuration to use with Gordon AI. In a new directory, create a <code class="language-plaintext highlighter-rouge">gordon-mcp.yml</code> file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">weather</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mcp/weather</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">WEATHER_API_KEY=your_real_api_key_here</span>  <span class="c1"># Get from weatherapi.com</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8080:8080"</span>
</code></pre></div></div>

<p>Now test your MCP server with Gordon:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker ai <span class="s2">"What's the current weather in San Francisco?"</span>
</code></pre></div></div>

<p>Try a more complex query:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker ai <span class="s2">"Give me a 3-day weather forecast for Tokyo and suggest appropriate clothing for each day."</span>
</code></pre></div></div>

<h2 id="step-5-enhancing-your-mcp-server">Step 5: Enhancing Your MCP Server</h2>

<p>To make your MCP server more useful, consider these enhancements:</p>

<h3 id="error-handling">Error Handling</h3>

<p>Improve error handling by adding more detailed error messages and fallbacks for when the external API is unavailable.</p>

<h3 id="caching">Caching</h3>

<p>Add caching to reduce redundant API calls for the same locations within a short time period:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">fastapi_cache</span> <span class="kn">import</span> <span class="n">FastAPICache</span>
<span class="kn">from</span> <span class="nn">fastapi_cache.backends.redis</span> <span class="kn">import</span> <span class="n">RedisBackend</span>
<span class="kn">from</span> <span class="nn">fastapi_cache.decorator</span> <span class="kn">import</span> <span class="n">cache</span>
<span class="kn">import</span> <span class="nn">redis</span>

<span class="c1"># Initialize cache in your app startup
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">on_event</span><span class="p">(</span><span class="s">"startup"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">startup</span><span class="p">():</span>
    <span class="n">redis_client</span> <span class="o">=</span> <span class="n">redis</span><span class="p">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">"redis"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">"utf8"</span><span class="p">)</span>
    <span class="n">FastAPICache</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">RedisBackend</span><span class="p">(</span><span class="n">redis_client</span><span class="p">),</span> <span class="n">prefix</span><span class="o">=</span><span class="s">"weather_cache:"</span><span class="p">)</span>

<span class="c1"># Add caching to your endpoints
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"/mcp/get_current_weather"</span><span class="p">)</span>
<span class="o">@</span><span class="n">cache</span><span class="p">(</span><span class="n">expire</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>  <span class="c1"># Cache for 5 minutes
</span><span class="k">async</span> <span class="k">def</span> <span class="nf">current_weather</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">WeatherRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MCPFunctionResponse</span><span class="p">:</span>
    <span class="c1"># Existing implementation...
</span></code></pre></div></div>

<h3 id="add-health-checks">Add Health Checks</h3>

<p>Implement health checks to ensure your MCP server is operating correctly:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"/health"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">health_check</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">"status"</span><span class="p">:</span> <span class="s">"healthy"</span><span class="p">,</span> <span class="s">"version"</span><span class="p">:</span> <span class="s">"1.0.0"</span><span class="p">}</span>
</code></pre></div></div>

<h2 id="step-6-extending-to-other-use-cases">Step 6: Extending to Other Use Cases</h2>

<p>Once you’ve built one MCP server, you can apply the same pattern to other domains:</p>

<ul>
  <li><strong>Stock Market Data</strong>: Create an MCP server for fetching financial information</li>
  <li><strong>Local Services</strong>: Build an MCP server that queries your internal APIs or services</li>
  <li><strong>IoT Control</strong>: Develop an MCP server to monitor and control IoT devices</li>
  <li><strong>Custom Analytics</strong>: Make an MCP server that performs specialized data analysis</li>
</ul>

<h2 id="step-7-production-deployment">Step 7: Production Deployment</h2>

<p>When deploying your MCP server to production, consider:</p>

<h3 id="security">Security</h3>

<ul>
  <li>Use proper authentication for sensitive operations</li>
  <li>Implement rate limiting to prevent abuse</li>
  <li>Never hardcode API keys; use environment variables or secrets management</li>
</ul>

<h3 id="reliability">Reliability</h3>

<ul>
  <li>Implement retry logic for transient failures</li>
  <li>Add monitoring and alerting</li>
  <li>Include comprehensive logging</li>
</ul>

<h3 id="docker-compose-for-production">Docker Compose for Production</h3>

<p>A more complete Docker Compose file for production might look like:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">weather-mcp</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mcp/weather:latest</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">WEATHER_API_KEY=${WEATHER_API_KEY}</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">8080:8080"</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:8080/health"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">timeout</span><span class="pi">:</span> <span class="s">10s</span>
      <span class="na">retries</span><span class="pi">:</span> <span class="m">3</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis</span>
  
  <span class="na">redis</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">redis:alpine</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">redis-data:/data</span>
    <span class="na">expose</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="m">6379</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">redis-data</span><span class="pi">:</span>
</code></pre></div></div>

<h2 id="complete-mcp-server-example">Complete MCP Server Example</h2>

<p>You can find a complete working example of this MCP server in the <a href="https://github.com/collabnix/custom-mcp-examples">Custom MCP Server Examples</a> repository.</p>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>Common issues and solutions:</p>

<ul>
  <li><strong>MCP Discovery Fails</strong>: Ensure the <code class="language-plaintext highlighter-rouge">/.well-known/mcp</code> endpoint returns the correct structure</li>
  <li><strong>Function Calls Error</strong>: Check that your function payload matches the defined schema</li>
  <li><strong>Docker Networking</strong>: If MCP servers can’t communicate, check that they’re on the same Docker network</li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>You’ve now learned how to build and deploy your own custom MCP server using Docker. This approach allows you to extend AI assistants like Gordon with specialized capabilities unique to your use case.</p>

<p>By providing an MCP interface to your own services and APIs, you enable AI assistants to work more effectively in your specific domain, creating more powerful and context-aware interactions.</p>

<h2 id="next-steps">Next Steps</h2>

<ul>
  <li><a href="/docs/labs/production-deployment-lab">Lab 4: Deploying MCP Servers to Production</a></li>
  <li><a href="/docs/tutorials/mcp-auth-security">Learn about MCP Authentication and Security</a></li>
  <li><a href="/docs/contributing">Contributing Your MCP Server to the Community</a></li>
</ul>

  </main>
  
  <footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-info">
        <h3>Docker MCP Community Portal</h3>
        <p>A community-driven resource for Docker Model Context Protocol.</p>
        <p>&copy; 2025 MCP Community Portal. All rights reserved.</p>
      </div>
      <div class="footer-links">
        <h4>Resources</h4>
        <ul>
          <li>
            <a href="https://github.com/ajeetraina/docker-mcp-portal" target="_blank">
              <i class="fab fa-github"></i> GitHub Repository
            </a>
          </li>
          <li>
            <a href="https://collabnix.com" target="_blank">
              <i class="fas fa-globe"></i> Collabnix Community
            </a>
          </li>
          <li>
            <a href="https://github.com/ajeetraina/docker-mcp-portal/blob/main/CONTRIBUTING.md" target="_blank">
              <i class="fas fa-code-branch"></i> Contribute to MCP Portal
            </a>
          </li>
          <li>
            <a href="https://hub.docker.com/u/mcp" target="_blank">
              <i class="fab fa-docker"></i> MCP on Docker Hub
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</footer>
  
  <!-- ClipboardJS for copy functionality -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.10/clipboard.min.js"></script>
  
  <!-- Syntax highlighting -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  
  <!-- Custom scripts -->
  <script src="/pr-preview/pr-26/assets/js/filter.js"></script>
  <script src="/pr-preview/pr-26/assets/js/code-formatter.js"></script>
  
  <script>
    // Initialize clipboard.js
    document.addEventListener('DOMContentLoaded', function() {
      var clipboard = new ClipboardJS('.btn-copy');
      
      clipboard.on('success', function(e) {
        var button = e.trigger;
        var originalText = button.innerHTML;
        
        button.innerHTML = '<i class="fas fa-check"></i> Copied!';
        button.classList.add('copied');
        
        setTimeout(function() {
          button.innerHTML = originalText;
          button.classList.remove('copied');
        }, 2000);
        
        e.clearSelection();
      });
      
      // Initialize syntax highlighting
      document.querySelectorAll('pre code').forEach((el) => {
        hljs.highlightElement(el);
      });
    });
  </script>
</body>
</html>